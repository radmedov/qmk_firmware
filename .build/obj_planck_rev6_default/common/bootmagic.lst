   1              		.cpu cortex-m4
   2              		.eabi_attribute 20, 1
   3              		.eabi_attribute 21, 1
   4              		.eabi_attribute 23, 3
   5              		.eabi_attribute 24, 1
   6              		.eabi_attribute 25, 1
   7              		.eabi_attribute 26, 1
   8              		.eabi_attribute 30, 4
   9              		.eabi_attribute 34, 1
  10              		.eabi_attribute 18, 2
  11              		.file	"bootmagic.c"
  12              		.text
  13              	.Ltext0:
  14              		.cfi_sections	.debug_frame
  15              		.section	.text.scan_keycode,"ax",%progbits
  16              		.align	1
  17              		.syntax unified
  18              		.thumb
  19              		.thumb_func
  20              		.fpu softvfp
  22              	scan_keycode:
  23              	.LFB283:
  24              		.file 1 "tmk_core/common/bootmagic.c"
   1:tmk_core/common/bootmagic.c **** #include <stdint.h>
   2:tmk_core/common/bootmagic.c **** #include <stdbool.h>
   3:tmk_core/common/bootmagic.c **** #include "wait.h"
   4:tmk_core/common/bootmagic.c **** #include "matrix.h"
   5:tmk_core/common/bootmagic.c **** #include "bootloader.h"
   6:tmk_core/common/bootmagic.c **** #include "debug.h"
   7:tmk_core/common/bootmagic.c **** #include "keymap.h"
   8:tmk_core/common/bootmagic.c **** #include "host.h"
   9:tmk_core/common/bootmagic.c **** #include "action_layer.h"
  10:tmk_core/common/bootmagic.c **** #include "eeconfig.h"
  11:tmk_core/common/bootmagic.c **** #include "bootmagic.h"
  12:tmk_core/common/bootmagic.c **** 
  13:tmk_core/common/bootmagic.c **** keymap_config_t keymap_config;
  14:tmk_core/common/bootmagic.c **** 
  15:tmk_core/common/bootmagic.c **** /** \brief Bootmagic
  16:tmk_core/common/bootmagic.c ****  *
  17:tmk_core/common/bootmagic.c ****  * FIXME: needs doc
  18:tmk_core/common/bootmagic.c ****  */
  19:tmk_core/common/bootmagic.c **** void bootmagic(void) {
  20:tmk_core/common/bootmagic.c ****     /* check signature */
  21:tmk_core/common/bootmagic.c ****     if (!eeconfig_is_enabled()) {
  22:tmk_core/common/bootmagic.c ****         eeconfig_init();
  23:tmk_core/common/bootmagic.c ****     }
  24:tmk_core/common/bootmagic.c **** 
  25:tmk_core/common/bootmagic.c ****     /* do scans in case of bounce */
  26:tmk_core/common/bootmagic.c ****     print("bootmagic scan: ... ");
  27:tmk_core/common/bootmagic.c ****     uint8_t scan = 100;
  28:tmk_core/common/bootmagic.c ****     while (scan--) {
  29:tmk_core/common/bootmagic.c ****         matrix_scan();
  30:tmk_core/common/bootmagic.c ****         wait_ms(10);
  31:tmk_core/common/bootmagic.c ****     }
  32:tmk_core/common/bootmagic.c ****     print("done.\n");
  33:tmk_core/common/bootmagic.c **** 
  34:tmk_core/common/bootmagic.c ****     /* bootmagic skip */
  35:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_SKIP)) {
  36:tmk_core/common/bootmagic.c ****         return;
  37:tmk_core/common/bootmagic.c ****     }
  38:tmk_core/common/bootmagic.c **** 
  39:tmk_core/common/bootmagic.c ****     /* eeconfig clear */
  40:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_EEPROM_CLEAR)) {
  41:tmk_core/common/bootmagic.c ****         eeconfig_init();
  42:tmk_core/common/bootmagic.c ****     }
  43:tmk_core/common/bootmagic.c **** 
  44:tmk_core/common/bootmagic.c ****     /* bootloader */
  45:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_BOOTLOADER)) {
  46:tmk_core/common/bootmagic.c ****         bootloader_jump();
  47:tmk_core/common/bootmagic.c ****     }
  48:tmk_core/common/bootmagic.c **** 
  49:tmk_core/common/bootmagic.c ****     /* debug enable */
  50:tmk_core/common/bootmagic.c ****     debug_config.raw = eeconfig_read_debug();
  51:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_DEBUG_ENABLE)) {
  52:tmk_core/common/bootmagic.c ****         if (bootmagic_scan_keycode(BOOTMAGIC_KEY_DEBUG_MATRIX)) {
  53:tmk_core/common/bootmagic.c ****             debug_config.matrix = !debug_config.matrix;
  54:tmk_core/common/bootmagic.c ****         } else if (bootmagic_scan_keycode(BOOTMAGIC_KEY_DEBUG_KEYBOARD)) {
  55:tmk_core/common/bootmagic.c ****             debug_config.keyboard = !debug_config.keyboard;
  56:tmk_core/common/bootmagic.c ****         } else if (bootmagic_scan_keycode(BOOTMAGIC_KEY_DEBUG_MOUSE)) {
  57:tmk_core/common/bootmagic.c ****             debug_config.mouse = !debug_config.mouse;
  58:tmk_core/common/bootmagic.c ****         } else {
  59:tmk_core/common/bootmagic.c ****             debug_config.enable = !debug_config.enable;
  60:tmk_core/common/bootmagic.c ****         }
  61:tmk_core/common/bootmagic.c ****     }
  62:tmk_core/common/bootmagic.c ****     eeconfig_update_debug(debug_config.raw);
  63:tmk_core/common/bootmagic.c **** 
  64:tmk_core/common/bootmagic.c ****     /* keymap config */
  65:tmk_core/common/bootmagic.c ****     keymap_config.raw = eeconfig_read_keymap();
  66:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_SWAP_CONTROL_CAPSLOCK)) {
  67:tmk_core/common/bootmagic.c ****         keymap_config.swap_control_capslock = !keymap_config.swap_control_capslock;
  68:tmk_core/common/bootmagic.c ****     }
  69:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_CAPSLOCK_TO_CONTROL)) {
  70:tmk_core/common/bootmagic.c ****         keymap_config.capslock_to_control = !keymap_config.capslock_to_control;
  71:tmk_core/common/bootmagic.c ****     }
  72:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_SWAP_LALT_LGUI)) {
  73:tmk_core/common/bootmagic.c ****         keymap_config.swap_lalt_lgui = !keymap_config.swap_lalt_lgui;
  74:tmk_core/common/bootmagic.c ****     }
  75:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_SWAP_RALT_RGUI)) {
  76:tmk_core/common/bootmagic.c ****         keymap_config.swap_ralt_rgui = !keymap_config.swap_ralt_rgui;
  77:tmk_core/common/bootmagic.c ****     }
  78:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_NO_GUI)) {
  79:tmk_core/common/bootmagic.c ****         keymap_config.no_gui = !keymap_config.no_gui;
  80:tmk_core/common/bootmagic.c ****     }
  81:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_SWAP_GRAVE_ESC)) {
  82:tmk_core/common/bootmagic.c ****         keymap_config.swap_grave_esc = !keymap_config.swap_grave_esc;
  83:tmk_core/common/bootmagic.c ****     }
  84:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_SWAP_BACKSLASH_BACKSPACE)) {
  85:tmk_core/common/bootmagic.c ****         keymap_config.swap_backslash_backspace = !keymap_config.swap_backslash_backspace;
  86:tmk_core/common/bootmagic.c ****     }
  87:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_HOST_NKRO)) {
  88:tmk_core/common/bootmagic.c ****         keymap_config.nkro = !keymap_config.nkro;
  89:tmk_core/common/bootmagic.c ****     }
  90:tmk_core/common/bootmagic.c ****     eeconfig_update_keymap(keymap_config.raw);
  91:tmk_core/common/bootmagic.c **** 
  92:tmk_core/common/bootmagic.c ****     /* default layer */
  93:tmk_core/common/bootmagic.c ****     uint8_t default_layer = 0;
  94:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_DEFAULT_LAYER_0)) {
  95:tmk_core/common/bootmagic.c ****         default_layer |= (1 << 0);
  96:tmk_core/common/bootmagic.c ****     }
  97:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_DEFAULT_LAYER_1)) {
  98:tmk_core/common/bootmagic.c ****         default_layer |= (1 << 1);
  99:tmk_core/common/bootmagic.c ****     }
 100:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_DEFAULT_LAYER_2)) {
 101:tmk_core/common/bootmagic.c ****         default_layer |= (1 << 2);
 102:tmk_core/common/bootmagic.c ****     }
 103:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_DEFAULT_LAYER_3)) {
 104:tmk_core/common/bootmagic.c ****         default_layer |= (1 << 3);
 105:tmk_core/common/bootmagic.c ****     }
 106:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_DEFAULT_LAYER_4)) {
 107:tmk_core/common/bootmagic.c ****         default_layer |= (1 << 4);
 108:tmk_core/common/bootmagic.c ****     }
 109:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_DEFAULT_LAYER_5)) {
 110:tmk_core/common/bootmagic.c ****         default_layer |= (1 << 5);
 111:tmk_core/common/bootmagic.c ****     }
 112:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_DEFAULT_LAYER_6)) {
 113:tmk_core/common/bootmagic.c ****         default_layer |= (1 << 6);
 114:tmk_core/common/bootmagic.c ****     }
 115:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_DEFAULT_LAYER_7)) {
 116:tmk_core/common/bootmagic.c ****         default_layer |= (1 << 7);
 117:tmk_core/common/bootmagic.c ****     }
 118:tmk_core/common/bootmagic.c ****     if (default_layer) {
 119:tmk_core/common/bootmagic.c ****         eeconfig_update_default_layer(default_layer);
 120:tmk_core/common/bootmagic.c ****         default_layer_set((layer_state_t)default_layer);
 121:tmk_core/common/bootmagic.c ****     } else {
 122:tmk_core/common/bootmagic.c ****         default_layer = eeconfig_read_default_layer();
 123:tmk_core/common/bootmagic.c ****         default_layer_set((layer_state_t)default_layer);
 124:tmk_core/common/bootmagic.c ****     }
 125:tmk_core/common/bootmagic.c **** }
 126:tmk_core/common/bootmagic.c **** 
 127:tmk_core/common/bootmagic.c **** /** \brief Scan Keycode
 128:tmk_core/common/bootmagic.c ****  *
 129:tmk_core/common/bootmagic.c ****  * FIXME: needs doc
 130:tmk_core/common/bootmagic.c ****  */
 131:tmk_core/common/bootmagic.c **** static bool scan_keycode(uint8_t keycode) {
  25              		.loc 1 131 0
  26              		.cfi_startproc
  27              		@ args = 0, pretend = 0, frame = 8
  28              		@ frame_needed = 0, uses_anonymous_args = 0
  29              	.LVL0:
  30 0000 2DE9F341 		push	{r0, r1, r4, r5, r6, r7, r8, lr}
  31              		.cfi_def_cfa_offset 32
  32              		.cfi_offset 4, -24
  33              		.cfi_offset 5, -20
  34              		.cfi_offset 6, -16
  35              		.cfi_offset 7, -12
  36              		.cfi_offset 8, -8
  37              		.cfi_offset 14, -4
  38              		.loc 1 131 0
  39 0004 0025     		movs	r5, #0
  40              	.LBB2:
  41              	.LBB3:
  42              	.LBB4:
 132:tmk_core/common/bootmagic.c ****     for (uint8_t r = 0; r < MATRIX_ROWS; r++) {
 133:tmk_core/common/bootmagic.c ****         matrix_row_t matrix_row = matrix_get_row(r);
 134:tmk_core/common/bootmagic.c ****         for (uint8_t c = 0; c < MATRIX_COLS; c++) {
 135:tmk_core/common/bootmagic.c ****             if (matrix_row & ((matrix_row_t)1 << c)) {
 136:tmk_core/common/bootmagic.c ****                 if (keycode == keymap_key_to_keycode(0, (keypos_t){.row = r, .col = c})) {
  43              		.loc 1 136 0
  44 0006 0746     		mov	r7, r0
  45              	.LVL1:
  46              	.L7:
  47 0008 EEB2     		uxtb	r6, r5
  48              	.LVL2:
  49              	.LBE4:
 133:tmk_core/common/bootmagic.c ****         for (uint8_t c = 0; c < MATRIX_COLS; c++) {
  50              		.loc 1 133 0
  51 000a 3046     		mov	r0, r6
  52 000c FFF7FEFF 		bl	matrix_get_row
  53              	.LVL3:
  54 0010 0024     		movs	r4, #0
  55 0012 8046     		mov	r8, r0
  56              	.LVL4:
  57              	.L3:
  58              	.LBB5:
 135:tmk_core/common/bootmagic.c ****                 if (keycode == keymap_key_to_keycode(0, (keypos_t){.row = r, .col = c})) {
  59              		.loc 1 135 0
  60 0014 48FA04F2 		asr	r2, r8, r4
  61 0018 D207     		lsls	r2, r2, #31
  62 001a E3B2     		uxtb	r3, r4
  63              	.LVL5:
  64 001c 09D4     		bmi	.L2
  65              	.LVL6:
  66              	.L6:
  67 001e 0134     		adds	r4, r4, #1
  68              	.LVL7:
 134:tmk_core/common/bootmagic.c ****             if (matrix_row & ((matrix_row_t)1 << c)) {
  69              		.loc 1 134 0
  70 0020 062C     		cmp	r4, #6
  71 0022 F7D1     		bne	.L3
  72              	.LVL8:
  73 0024 0135     		adds	r5, r5, #1
  74              	.LVL9:
  75              	.LBE5:
  76              	.LBE3:
 132:tmk_core/common/bootmagic.c ****         matrix_row_t matrix_row = matrix_get_row(r);
  77              		.loc 1 132 0 discriminator 2
  78 0026 082D     		cmp	r5, #8
  79 0028 EED1     		bne	.L7
  80              	.LBE2:
 137:tmk_core/common/bootmagic.c ****                     return true;
 138:tmk_core/common/bootmagic.c ****                 }
 139:tmk_core/common/bootmagic.c ****             }
 140:tmk_core/common/bootmagic.c ****         }
 141:tmk_core/common/bootmagic.c ****     }
 142:tmk_core/common/bootmagic.c ****     return false;
  81              		.loc 1 142 0
  82 002a 0020     		movs	r0, #0
  83              	.LVL10:
  84              	.L5:
 143:tmk_core/common/bootmagic.c **** }
  85              		.loc 1 143 0
  86 002c 02B0     		add	sp, sp, #8
  87              		.cfi_remember_state
  88              		.cfi_def_cfa_offset 24
  89              		@ sp needed
  90 002e BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
  91              	.LVL11:
  92              	.L2:
  93              		.cfi_restore_state
  94              	.LBB8:
  95              	.LBB7:
  96              	.LBB6:
 136:tmk_core/common/bootmagic.c ****                     return true;
  97              		.loc 1 136 0
  98 0032 8DF80430 		strb	r3, [sp, #4]
  99 0036 8DF80560 		strb	r6, [sp, #5]
 100 003a 0199     		ldr	r1, [sp, #4]
 101 003c 0020     		movs	r0, #0
 102 003e FFF7FEFF 		bl	keymap_key_to_keycode
 103              	.LVL12:
 104 0042 8742     		cmp	r7, r0
 105 0044 EBD1     		bne	.L6
 137:tmk_core/common/bootmagic.c ****                     return true;
 106              		.loc 1 137 0
 107 0046 0120     		movs	r0, #1
 108 0048 F0E7     		b	.L5
 109              	.LBE6:
 110              	.LBE7:
 111              	.LBE8:
 112              		.cfi_endproc
 113              	.LFE283:
 115              		.section	.text.bootmagic_scan_keycode,"ax",%progbits
 116              		.align	1
 117              		.global	bootmagic_scan_keycode
 118              		.syntax unified
 119              		.thumb
 120              		.thumb_func
 121              		.fpu softvfp
 123              	bootmagic_scan_keycode:
 124              	.LFB284:
 144:tmk_core/common/bootmagic.c **** 
 145:tmk_core/common/bootmagic.c **** /** \brief Bootmagic Scan Keycode
 146:tmk_core/common/bootmagic.c ****  *
 147:tmk_core/common/bootmagic.c ****  * FIXME: needs doc
 148:tmk_core/common/bootmagic.c ****  */
 149:tmk_core/common/bootmagic.c **** bool bootmagic_scan_keycode(uint8_t keycode) {
 125              		.loc 1 149 0
 126              		.cfi_startproc
 127              		@ args = 0, pretend = 0, frame = 0
 128              		@ frame_needed = 0, uses_anonymous_args = 0
 129              	.LVL13:
 130 0000 10B5     		push	{r4, lr}
 131              		.cfi_def_cfa_offset 8
 132              		.cfi_offset 4, -8
 133              		.cfi_offset 14, -4
 134              		.loc 1 149 0
 135 0002 0446     		mov	r4, r0
 150:tmk_core/common/bootmagic.c ****     if (!scan_keycode(BOOTMAGIC_KEY_SALT)) return false;
 136              		.loc 1 150 0
 137 0004 2C20     		movs	r0, #44
 138              	.LVL14:
 139 0006 FFF7FEFF 		bl	scan_keycode
 140              	.LVL15:
 141 000a 20B1     		cbz	r0, .L13
 151:tmk_core/common/bootmagic.c **** 
 152:tmk_core/common/bootmagic.c ****     return scan_keycode(keycode);
 142              		.loc 1 152 0
 143 000c 2046     		mov	r0, r4
 153:tmk_core/common/bootmagic.c **** }
 144              		.loc 1 153 0
 145 000e BDE81040 		pop	{r4, lr}
 146              		.cfi_remember_state
 147              		.cfi_restore 14
 148              		.cfi_restore 4
 149              		.cfi_def_cfa_offset 0
 152:tmk_core/common/bootmagic.c **** }
 150              		.loc 1 152 0
 151 0012 FFF7FEBF 		b	scan_keycode
 152              	.LVL16:
 153              	.L13:
 154              		.cfi_restore_state
 155              		.loc 1 153 0
 156 0016 10BD     		pop	{r4, pc}
 157              		.cfi_endproc
 158              	.LFE284:
 160              		.section	.text.bootmagic,"ax",%progbits
 161              		.align	1
 162              		.global	bootmagic
 163              		.syntax unified
 164              		.thumb
 165              		.thumb_func
 166              		.fpu softvfp
 168              	bootmagic:
 169              	.LFB282:
  19:tmk_core/common/bootmagic.c ****     /* check signature */
 170              		.loc 1 19 0
 171              		.cfi_startproc
 172              		@ args = 0, pretend = 0, frame = 0
 173              		@ frame_needed = 0, uses_anonymous_args = 0
 174 0000 10B5     		push	{r4, lr}
 175              		.cfi_def_cfa_offset 8
 176              		.cfi_offset 4, -8
 177              		.cfi_offset 14, -4
  21:tmk_core/common/bootmagic.c ****         eeconfig_init();
 178              		.loc 1 21 0
 179 0002 FFF7FEFF 		bl	eeconfig_is_enabled
 180              	.LVL17:
 181 0006 08B9     		cbnz	r0, .L15
  22:tmk_core/common/bootmagic.c ****     }
 182              		.loc 1 22 0
 183 0008 FFF7FEFF 		bl	eeconfig_init
 184              	.LVL18:
 185              	.L15:
  26:tmk_core/common/bootmagic.c ****     uint8_t scan = 100;
 186              		.loc 1 26 0
 187 000c 8348     		ldr	r0, .L95
 188 000e FFF7FEFF 		bl	tfp_printf
 189              	.LVL19:
  28:tmk_core/common/bootmagic.c ****         matrix_scan();
 190              		.loc 1 28 0
 191 0012 6524     		movs	r4, #101
 192              	.LVL20:
 193              	.L16:
 194 0014 013C     		subs	r4, r4, #1
 195              	.LVL21:
 196 0016 14F0FF04 		ands	r4, r4, #255
 197 001a 40F0D280 		bne	.L17
  32:tmk_core/common/bootmagic.c **** 
 198              		.loc 1 32 0
 199 001e 8048     		ldr	r0, .L95+4
 200 0020 FFF7FEFF 		bl	tfp_printf
 201              	.LVL22:
  35:tmk_core/common/bootmagic.c ****         return;
 202              		.loc 1 35 0
 203 0024 2920     		movs	r0, #41
 204 0026 FFF7FEFF 		bl	bootmagic_scan_keycode
 205              	.LVL23:
 206 002a 0028     		cmp	r0, #0
 207 002c 40F0F480 		bne	.L14
  40:tmk_core/common/bootmagic.c ****         eeconfig_init();
 208              		.loc 1 40 0
 209 0030 2A20     		movs	r0, #42
 210 0032 FFF7FEFF 		bl	bootmagic_scan_keycode
 211              	.LVL24:
 212 0036 08B1     		cbz	r0, .L19
  41:tmk_core/common/bootmagic.c ****     }
 213              		.loc 1 41 0
 214 0038 FFF7FEFF 		bl	eeconfig_init
 215              	.LVL25:
 216              	.L19:
  45:tmk_core/common/bootmagic.c ****         bootloader_jump();
 217              		.loc 1 45 0
 218 003c 0520     		movs	r0, #5
 219 003e FFF7FEFF 		bl	bootmagic_scan_keycode
 220              	.LVL26:
 221 0042 08B1     		cbz	r0, .L20
  46:tmk_core/common/bootmagic.c ****     }
 222              		.loc 1 46 0
 223 0044 FFF7FEFF 		bl	bootloader_jump
 224              	.LVL27:
 225              	.L20:
  50:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_DEBUG_ENABLE)) {
 226              		.loc 1 50 0
 227 0048 FFF7FEFF 		bl	eeconfig_read_debug
 228              	.LVL28:
 229 004c 754C     		ldr	r4, .L95+8
 230 004e 2070     		strb	r0, [r4]
  51:tmk_core/common/bootmagic.c ****         if (bootmagic_scan_keycode(BOOTMAGIC_KEY_DEBUG_MATRIX)) {
 231              		.loc 1 51 0
 232 0050 0720     		movs	r0, #7
 233 0052 FFF7FEFF 		bl	bootmagic_scan_keycode
 234              	.LVL29:
 235 0056 68B1     		cbz	r0, .L21
  52:tmk_core/common/bootmagic.c ****             debug_config.matrix = !debug_config.matrix;
 236              		.loc 1 52 0
 237 0058 1B20     		movs	r0, #27
 238 005a FFF7FEFF 		bl	bootmagic_scan_keycode
 239              	.LVL30:
 240 005e 0028     		cmp	r0, #0
 241 0060 00F0B680 		beq	.L22
  53:tmk_core/common/bootmagic.c ****         } else if (bootmagic_scan_keycode(BOOTMAGIC_KEY_DEBUG_KEYBOARD)) {
 242              		.loc 1 53 0
 243 0064 2378     		ldrb	r3, [r4]	@ zero_extendqisi2
 244 0066 C3F34002 		ubfx	r2, r3, #1, #1
 245 006a 82F00102 		eor	r2, r2, #1
 246 006e 62F34103 		bfi	r3, r2, #1, #1
 247              	.L93:
  59:tmk_core/common/bootmagic.c ****         }
 248              		.loc 1 59 0
 249 0072 2370     		strb	r3, [r4]
 250              	.L21:
  62:tmk_core/common/bootmagic.c **** 
 251              		.loc 1 62 0
 252 0074 2078     		ldrb	r0, [r4]	@ zero_extendqisi2
  65:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_SWAP_CONTROL_CAPSLOCK)) {
 253              		.loc 1 65 0
 254 0076 6C4C     		ldr	r4, .L95+12
  62:tmk_core/common/bootmagic.c **** 
 255              		.loc 1 62 0
 256 0078 FFF7FEFF 		bl	eeconfig_update_debug
 257              	.LVL31:
  65:tmk_core/common/bootmagic.c ****     if (bootmagic_scan_keycode(BOOTMAGIC_KEY_SWAP_CONTROL_CAPSLOCK)) {
 258              		.loc 1 65 0
 259 007c FFF7FEFF 		bl	eeconfig_read_keymap
 260              	.LVL32:
 261 0080 2080     		strh	r0, [r4]	@ movhi
  66:tmk_core/common/bootmagic.c ****         keymap_config.swap_control_capslock = !keymap_config.swap_control_capslock;
 262              		.loc 1 66 0
 263 0082 E020     		movs	r0, #224
 264 0084 FFF7FEFF 		bl	bootmagic_scan_keycode
 265              	.LVL33:
 266 0088 38B1     		cbz	r0, .L25
  67:tmk_core/common/bootmagic.c ****     }
 267              		.loc 1 67 0
 268 008a 2378     		ldrb	r3, [r4]	@ zero_extendqisi2
 269 008c C3F30002 		ubfx	r2, r3, #0, #1
 270 0090 82F00102 		eor	r2, r2, #1
 271 0094 62F30003 		bfi	r3, r2, #0, #1
 272 0098 2370     		strb	r3, [r4]
 273              	.L25:
  69:tmk_core/common/bootmagic.c ****         keymap_config.capslock_to_control = !keymap_config.capslock_to_control;
 274              		.loc 1 69 0
 275 009a 3920     		movs	r0, #57
 276 009c FFF7FEFF 		bl	bootmagic_scan_keycode
 277              	.LVL34:
 278 00a0 38B1     		cbz	r0, .L26
  70:tmk_core/common/bootmagic.c ****     }
 279              		.loc 1 70 0
 280 00a2 2378     		ldrb	r3, [r4]	@ zero_extendqisi2
 281 00a4 C3F34002 		ubfx	r2, r3, #1, #1
 282 00a8 82F00102 		eor	r2, r2, #1
 283 00ac 62F34103 		bfi	r3, r2, #1, #1
 284 00b0 2370     		strb	r3, [r4]
 285              	.L26:
  72:tmk_core/common/bootmagic.c ****         keymap_config.swap_lalt_lgui = !keymap_config.swap_lalt_lgui;
 286              		.loc 1 72 0
 287 00b2 E220     		movs	r0, #226
 288 00b4 FFF7FEFF 		bl	bootmagic_scan_keycode
 289              	.LVL35:
 290 00b8 38B1     		cbz	r0, .L27
  73:tmk_core/common/bootmagic.c ****     }
 291              		.loc 1 73 0
 292 00ba 2378     		ldrb	r3, [r4]	@ zero_extendqisi2
 293 00bc C3F38002 		ubfx	r2, r3, #2, #1
 294 00c0 82F00102 		eor	r2, r2, #1
 295 00c4 62F38203 		bfi	r3, r2, #2, #1
 296 00c8 2370     		strb	r3, [r4]
 297              	.L27:
  75:tmk_core/common/bootmagic.c ****         keymap_config.swap_ralt_rgui = !keymap_config.swap_ralt_rgui;
 298              		.loc 1 75 0
 299 00ca E620     		movs	r0, #230
 300 00cc FFF7FEFF 		bl	bootmagic_scan_keycode
 301              	.LVL36:
 302 00d0 38B1     		cbz	r0, .L28
  76:tmk_core/common/bootmagic.c ****     }
 303              		.loc 1 76 0
 304 00d2 2378     		ldrb	r3, [r4]	@ zero_extendqisi2
 305 00d4 C3F3C002 		ubfx	r2, r3, #3, #1
 306 00d8 82F00102 		eor	r2, r2, #1
 307 00dc 62F3C303 		bfi	r3, r2, #3, #1
 308 00e0 2370     		strb	r3, [r4]
 309              	.L28:
  78:tmk_core/common/bootmagic.c ****         keymap_config.no_gui = !keymap_config.no_gui;
 310              		.loc 1 78 0
 311 00e2 E320     		movs	r0, #227
 312 00e4 FFF7FEFF 		bl	bootmagic_scan_keycode
 313              	.LVL37:
 314 00e8 38B1     		cbz	r0, .L29
  79:tmk_core/common/bootmagic.c ****     }
 315              		.loc 1 79 0
 316 00ea 2378     		ldrb	r3, [r4]	@ zero_extendqisi2
 317 00ec C3F30012 		ubfx	r2, r3, #4, #1
 318 00f0 82F00102 		eor	r2, r2, #1
 319 00f4 62F30413 		bfi	r3, r2, #4, #1
 320 00f8 2370     		strb	r3, [r4]
 321              	.L29:
  81:tmk_core/common/bootmagic.c ****         keymap_config.swap_grave_esc = !keymap_config.swap_grave_esc;
 322              		.loc 1 81 0
 323 00fa 3520     		movs	r0, #53
 324 00fc FFF7FEFF 		bl	bootmagic_scan_keycode
 325              	.LVL38:
 326 0100 38B1     		cbz	r0, .L30
  82:tmk_core/common/bootmagic.c ****     }
 327              		.loc 1 82 0
 328 0102 2378     		ldrb	r3, [r4]	@ zero_extendqisi2
 329 0104 C3F34012 		ubfx	r2, r3, #5, #1
 330 0108 82F00102 		eor	r2, r2, #1
 331 010c 62F34513 		bfi	r3, r2, #5, #1
 332 0110 2370     		strb	r3, [r4]
 333              	.L30:
  84:tmk_core/common/bootmagic.c ****         keymap_config.swap_backslash_backspace = !keymap_config.swap_backslash_backspace;
 334              		.loc 1 84 0
 335 0112 3120     		movs	r0, #49
 336 0114 FFF7FEFF 		bl	bootmagic_scan_keycode
 337              	.LVL39:
 338 0118 38B1     		cbz	r0, .L31
  85:tmk_core/common/bootmagic.c ****     }
 339              		.loc 1 85 0
 340 011a 2378     		ldrb	r3, [r4]	@ zero_extendqisi2
 341 011c C3F38012 		ubfx	r2, r3, #6, #1
 342 0120 82F00102 		eor	r2, r2, #1
 343 0124 62F38613 		bfi	r3, r2, #6, #1
 344 0128 2370     		strb	r3, [r4]
 345              	.L31:
  87:tmk_core/common/bootmagic.c ****         keymap_config.nkro = !keymap_config.nkro;
 346              		.loc 1 87 0
 347 012a 1120     		movs	r0, #17
 348 012c FFF7FEFF 		bl	bootmagic_scan_keycode
 349              	.LVL40:
 350 0130 38B1     		cbz	r0, .L32
  88:tmk_core/common/bootmagic.c ****     }
 351              		.loc 1 88 0
 352 0132 2378     		ldrb	r3, [r4]	@ zero_extendqisi2
 353 0134 C3F3C012 		ubfx	r2, r3, #7, #1
 354 0138 82F00102 		eor	r2, r2, #1
 355 013c 62F3C713 		bfi	r3, r2, #7, #1
 356 0140 2370     		strb	r3, [r4]
 357              	.L32:
  90:tmk_core/common/bootmagic.c **** 
 358              		.loc 1 90 0
 359 0142 2088     		ldrh	r0, [r4]
 360 0144 FFF7FEFF 		bl	eeconfig_update_keymap
 361              	.LVL41:
  94:tmk_core/common/bootmagic.c ****         default_layer |= (1 << 0);
 362              		.loc 1 94 0
 363 0148 2720     		movs	r0, #39
 364 014a FFF7FEFF 		bl	bootmagic_scan_keycode
 365              	.LVL42:
 366 014e 0446     		mov	r4, r0
 367              	.LVL43:
  97:tmk_core/common/bootmagic.c ****         default_layer |= (1 << 1);
 368              		.loc 1 97 0
 369 0150 1E20     		movs	r0, #30
 370 0152 FFF7FEFF 		bl	bootmagic_scan_keycode
 371              	.LVL44:
 372 0156 10B1     		cbz	r0, .L33
  98:tmk_core/common/bootmagic.c ****     }
 373              		.loc 1 98 0
 374 0158 44F00204 		orr	r4, r4, #2
 375              	.LVL45:
 376 015c E4B2     		uxtb	r4, r4
 377              	.LVL46:
 378              	.L33:
 100:tmk_core/common/bootmagic.c ****         default_layer |= (1 << 2);
 379              		.loc 1 100 0
 380 015e 1F20     		movs	r0, #31
 381 0160 FFF7FEFF 		bl	bootmagic_scan_keycode
 382              	.LVL47:
 383 0164 10B1     		cbz	r0, .L34
 101:tmk_core/common/bootmagic.c ****     }
 384              		.loc 1 101 0
 385 0166 44F00404 		orr	r4, r4, #4
 386              	.LVL48:
 387 016a E4B2     		uxtb	r4, r4
 388              	.LVL49:
 389              	.L34:
 103:tmk_core/common/bootmagic.c ****         default_layer |= (1 << 3);
 390              		.loc 1 103 0
 391 016c 2020     		movs	r0, #32
 392 016e FFF7FEFF 		bl	bootmagic_scan_keycode
 393              	.LVL50:
 394 0172 10B1     		cbz	r0, .L35
 104:tmk_core/common/bootmagic.c ****     }
 395              		.loc 1 104 0
 396 0174 44F00804 		orr	r4, r4, #8
 397              	.LVL51:
 398 0178 E4B2     		uxtb	r4, r4
 399              	.LVL52:
 400              	.L35:
 106:tmk_core/common/bootmagic.c ****         default_layer |= (1 << 4);
 401              		.loc 1 106 0
 402 017a 2120     		movs	r0, #33
 403 017c FFF7FEFF 		bl	bootmagic_scan_keycode
 404              	.LVL53:
 405 0180 10B1     		cbz	r0, .L36
 107:tmk_core/common/bootmagic.c ****     }
 406              		.loc 1 107 0
 407 0182 44F01004 		orr	r4, r4, #16
 408              	.LVL54:
 409 0186 E4B2     		uxtb	r4, r4
 410              	.LVL55:
 411              	.L36:
 109:tmk_core/common/bootmagic.c ****         default_layer |= (1 << 5);
 412              		.loc 1 109 0
 413 0188 2220     		movs	r0, #34
 414 018a FFF7FEFF 		bl	bootmagic_scan_keycode
 415              	.LVL56:
 416 018e 10B1     		cbz	r0, .L37
 110:tmk_core/common/bootmagic.c ****     }
 417              		.loc 1 110 0
 418 0190 44F02004 		orr	r4, r4, #32
 419              	.LVL57:
 420 0194 E4B2     		uxtb	r4, r4
 421              	.LVL58:
 422              	.L37:
 112:tmk_core/common/bootmagic.c ****         default_layer |= (1 << 6);
 423              		.loc 1 112 0
 424 0196 2320     		movs	r0, #35
 425 0198 FFF7FEFF 		bl	bootmagic_scan_keycode
 426              	.LVL59:
 427 019c 10B1     		cbz	r0, .L38
 113:tmk_core/common/bootmagic.c ****     }
 428              		.loc 1 113 0
 429 019e 44F04004 		orr	r4, r4, #64
 430              	.LVL60:
 431 01a2 E4B2     		uxtb	r4, r4
 432              	.LVL61:
 433              	.L38:
 115:tmk_core/common/bootmagic.c ****         default_layer |= (1 << 7);
 434              		.loc 1 115 0
 435 01a4 2420     		movs	r0, #36
 436 01a6 FFF7FEFF 		bl	bootmagic_scan_keycode
 437              	.LVL62:
 438 01aa 80B3     		cbz	r0, .L39
 116:tmk_core/common/bootmagic.c ****     }
 439              		.loc 1 116 0
 440 01ac 64F07F04 		orn	r4, r4, #127
 441              	.LVL63:
 442 01b0 E4B2     		uxtb	r4, r4
 443              	.LVL64:
 444              	.L40:
 119:tmk_core/common/bootmagic.c ****         default_layer_set((layer_state_t)default_layer);
 445              		.loc 1 119 0
 446 01b2 2046     		mov	r0, r4
 447 01b4 FFF7FEFF 		bl	eeconfig_update_default_layer
 448              	.LVL65:
 120:tmk_core/common/bootmagic.c ****     } else {
 449              		.loc 1 120 0
 450 01b8 2046     		mov	r0, r4
 451              	.L94:
 452              	.LVL66:
 125:tmk_core/common/bootmagic.c **** 
 453              		.loc 1 125 0
 454 01ba BDE81040 		pop	{r4, lr}
 455              		.cfi_remember_state
 456              		.cfi_restore 14
 457              		.cfi_restore 4
 458              		.cfi_def_cfa_offset 0
 123:tmk_core/common/bootmagic.c ****     }
 459              		.loc 1 123 0
 460 01be FFF7FEBF 		b	default_layer_set
 461              	.LVL67:
 462              	.L17:
 463              		.cfi_restore_state
  29:tmk_core/common/bootmagic.c ****         wait_ms(10);
 464              		.loc 1 29 0
 465 01c2 FFF7FEFF 		bl	matrix_scan
 466              	.LVL68:
  30:tmk_core/common/bootmagic.c ****     }
 467              		.loc 1 30 0
 468 01c6 4FF47A70 		mov	r0, #1000
 469 01ca FFF7FEFF 		bl	chThdSleep
 470              	.LVL69:
 471 01ce 21E7     		b	.L16
 472              	.LVL70:
 473              	.L22:
  54:tmk_core/common/bootmagic.c ****             debug_config.keyboard = !debug_config.keyboard;
 474              		.loc 1 54 0
 475 01d0 0E20     		movs	r0, #14
 476 01d2 FFF7FEFF 		bl	bootmagic_scan_keycode
 477              	.LVL71:
 478 01d6 38B1     		cbz	r0, .L23
  55:tmk_core/common/bootmagic.c ****         } else if (bootmagic_scan_keycode(BOOTMAGIC_KEY_DEBUG_MOUSE)) {
 479              		.loc 1 55 0
 480 01d8 2378     		ldrb	r3, [r4]	@ zero_extendqisi2
 481 01da C3F38002 		ubfx	r2, r3, #2, #1
 482 01de 82F00102 		eor	r2, r2, #1
 483 01e2 62F38203 		bfi	r3, r2, #2, #1
 484 01e6 44E7     		b	.L93
 485              	.L23:
  56:tmk_core/common/bootmagic.c ****             debug_config.mouse = !debug_config.mouse;
 486              		.loc 1 56 0
 487 01e8 1020     		movs	r0, #16
 488 01ea FFF7FEFF 		bl	bootmagic_scan_keycode
 489              	.LVL72:
 490 01ee 2378     		ldrb	r3, [r4]	@ zero_extendqisi2
 491 01f0 30B1     		cbz	r0, .L24
  57:tmk_core/common/bootmagic.c ****         } else {
 492              		.loc 1 57 0
 493 01f2 C3F3C002 		ubfx	r2, r3, #3, #1
 494 01f6 82F00102 		eor	r2, r2, #1
 495 01fa 62F3C303 		bfi	r3, r2, #3, #1
 496 01fe 38E7     		b	.L93
 497              	.L24:
  59:tmk_core/common/bootmagic.c ****         }
 498              		.loc 1 59 0
 499 0200 C3F30002 		ubfx	r2, r3, #0, #1
 500 0204 82F00102 		eor	r2, r2, #1
 501 0208 62F30003 		bfi	r3, r2, #0, #1
 502 020c 31E7     		b	.L93
 503              	.LVL73:
 504              	.L39:
 118:tmk_core/common/bootmagic.c ****         eeconfig_update_default_layer(default_layer);
 505              		.loc 1 118 0
 506 020e 002C     		cmp	r4, #0
 507 0210 CFD1     		bne	.L40
 122:tmk_core/common/bootmagic.c ****         default_layer_set((layer_state_t)default_layer);
 508              		.loc 1 122 0
 509 0212 FFF7FEFF 		bl	eeconfig_read_default_layer
 510              	.LVL74:
 511 0216 D0E7     		b	.L94
 512              	.LVL75:
 513              	.L14:
 125:tmk_core/common/bootmagic.c **** 
 514              		.loc 1 125 0
 515 0218 10BD     		pop	{r4, pc}
 516              	.L96:
 517 021a 00BF     		.align	2
 518              	.L95:
 519 021c 00000000 		.word	.LC0
 520 0220 15000000 		.word	.LC1
 521 0224 00000000 		.word	debug_config
 522 0228 00000000 		.word	.LANCHOR0
 523              		.cfi_endproc
 524              	.LFE282:
 526              		.global	keymap_config
 527              		.section	.bss.keymap_config,"aw",%nobits
 528              		.align	1
 529              		.set	.LANCHOR0,. + 0
 532              	keymap_config:
 533 0000 0000     		.space	2
 534              		.section	.rodata.bootmagic.str1.1,"aMS",%progbits,1
 535              	.LC0:
 536 0000 626F6F74 		.ascii	"bootmagic scan: ... \000"
 536      6D616769 
 536      63207363 
 536      616E3A20 
 536      2E2E2E20 
 537              	.LC1:
 538 0015 646F6E65 		.ascii	"done.\012\000"
 538      2E0A00
 539              		.text
 540              	.Letext0:
 541              		.file 2 "/usr/local/Cellar/gcc-arm-none-eabi/20180627/arm-none-eabi/include/machine/_default_types
 542              		.file 3 "/usr/local/Cellar/gcc-arm-none-eabi/20180627/arm-none-eabi/include/sys/_stdint.h"
 543              		.file 4 "/usr/local/Cellar/gcc-arm-none-eabi/20180627/lib/gcc/arm-none-eabi/7.3.1/include/stddef.h
 544              		.file 5 "./lib/chibios/os/common/ports/ARMCMx/compilers/GCC/chtypes.h"
 545              		.file 6 "./lib/chibios/os/rt/include/chsystypes.h"
 546              		.file 7 "./lib/chibios/os/rt/include/chschd.h"
 547              		.file 8 "./lib/chibios/os/common/ext/CMSIS/include/core_cm4.h"
 548              		.file 9 "./lib/chibios/os/common/ext/CMSIS/ST/STM32F3xx/system_stm32f3xx.h"
 549              		.file 10 "./lib/chibios/os/common/ext/CMSIS/ST/STM32F3xx/stm32f303xc.h"
 550              		.file 11 "./lib/chibios/os/common/ports/ARMCMx/chcore.h"
 551              		.file 12 "./lib/chibios/os/common/ports/ARMCMx/chcore_v7m.h"
 552              		.file 13 "./lib/chibios/os/hal/ports/STM32/LLD/TIMv1/stm32_tim.h"
 553              		.file 14 "./lib/chibios/os/rt/include/chtm.h"
 554              		.file 15 "./lib/chibios/os/rt/include/chsem.h"
 555              		.file 16 "./lib/chibios/os/rt/include/chmtx.h"
 556              		.file 17 "./lib/chibios/os/rt/include/chsys.h"
 557              		.file 18 "./lib/chibios/os/rt/include/chregistry.h"
 558              		.file 19 "./lib/chibios/os/common/oslib/include/chmemcore.h"
 559              		.file 20 "tmk_core/common/matrix.h"
 560              		.file 21 "tmk_core/common/debug.h"
 561              		.file 22 "tmk_core/common/keyboard.h"
 562              		.file 23 "tmk_core/common/action.h"
 563              		.file 24 "./lib/chibios/os/hal/ports/STM32/LLD/DMAv1/stm32_dma.h"
 564              		.file 25 "./lib/chibios/os/hal/ports/STM32/LLD/GPIOv2/hal_pal_lld.h"
 565              		.file 26 "./lib/chibios/os/hal/include/hal_dac.h"
 566              		.file 27 "./lib/chibios/os/hal/ports/STM32/LLD/DACv1/hal_dac_lld.h"
 567              		.file 28 "./lib/chibios/os/hal/include/hal_gpt.h"
 568              		.file 29 "./lib/chibios/os/hal/ports/STM32/LLD/TIMv1/hal_gpt_lld.h"
 569              		.file 30 "./lib/chibios/os/hal/include/hal_i2c.h"
 570              		.file 31 "./lib/chibios/os/hal/ports/STM32/LLD/I2Cv2/hal_i2c_lld.h"
 571              		.file 32 "./lib/chibios/os/hal/include/hal_pwm.h"
 572              		.file 33 "./lib/chibios/os/hal/ports/STM32/LLD/TIMv1/hal_pwm_lld.h"
 573              		.file 34 "./lib/chibios/os/hal/include/hal_usb.h"
 574              		.file 35 "./lib/chibios/os/hal/ports/STM32/LLD/USBv1/hal_usb_lld.h"
 575              		.file 36 "tmk_core/common/host.h"
 576              		.file 37 "quantum/keycode_config.h"
 577              		.file 38 "quantum/keymap.h"
 578              		.file 39 "tmk_core/common/action_layer.h"
 579              		.file 40 "tmk_core/common/eeconfig.h"
 580              		.file 41 "tmk_core/common/chibios/printf.h"
 581              		.file 42 "tmk_core/common/bootloader.h"
 582              		.file 43 "./lib/chibios/os/rt/include/chthreads.h"
 583              		.file 44 "tmk_core/common/keycode.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 bootmagic.c
/var/folders/qs/3p__ddh573j_6k2216pg8mv40000gn/T//cc6zO6kT.s:16     .text.scan_keycode:0000000000000000 $t
/var/folders/qs/3p__ddh573j_6k2216pg8mv40000gn/T//cc6zO6kT.s:22     .text.scan_keycode:0000000000000000 scan_keycode
/var/folders/qs/3p__ddh573j_6k2216pg8mv40000gn/T//cc6zO6kT.s:116    .text.bootmagic_scan_keycode:0000000000000000 $t
/var/folders/qs/3p__ddh573j_6k2216pg8mv40000gn/T//cc6zO6kT.s:123    .text.bootmagic_scan_keycode:0000000000000000 bootmagic_scan_keycode
/var/folders/qs/3p__ddh573j_6k2216pg8mv40000gn/T//cc6zO6kT.s:161    .text.bootmagic:0000000000000000 $t
/var/folders/qs/3p__ddh573j_6k2216pg8mv40000gn/T//cc6zO6kT.s:168    .text.bootmagic:0000000000000000 bootmagic
/var/folders/qs/3p__ddh573j_6k2216pg8mv40000gn/T//cc6zO6kT.s:519    .text.bootmagic:000000000000021c $d
/var/folders/qs/3p__ddh573j_6k2216pg8mv40000gn/T//cc6zO6kT.s:532    .bss.keymap_config:0000000000000000 keymap_config
/var/folders/qs/3p__ddh573j_6k2216pg8mv40000gn/T//cc6zO6kT.s:528    .bss.keymap_config:0000000000000000 $d

UNDEFINED SYMBOLS
matrix_get_row
keymap_key_to_keycode
eeconfig_is_enabled
eeconfig_init
tfp_printf
bootloader_jump
eeconfig_read_debug
eeconfig_update_debug
eeconfig_read_keymap
eeconfig_update_keymap
eeconfig_update_default_layer
default_layer_set
matrix_scan
chThdSleep
eeconfig_read_default_layer
debug_config
